- Deploy Istio - Install custom resource definitions and demo configuration

kubectl apply -f 01-istio-crds.yml

kubectl apply -f 02-istio-demo.yml

- Verify istio

kubectl get all -n istio-system

- Configure auto proxy injection for default namespace

kubectl label namespace default istio-injection=enabled

kubectl describe namespace default

kubectl apply -f 03-default-namespace.yml

- Deploying an Istio-managed app and configure gateway

kubectl apply -f 04-simple-go-service.yml

kubectl apply -f 05-simple-go-service-gateway.yml

kubectl describe pods -l app=simple-go-service

kubectl get svc istio-ingressgateway -n istio-system

- Deploy an application in a legacy namespace for testing purposes

kubectl apply -f 06-sleep.yml

- Check default mesh policy:

kubectl describe meshpolicy default

- Find the legacy app container:

docker container ls --filter name=k8s_sleep

$id=$(docker container ls --filter name=k8s_sleep --format '{{ .ID}}')

- Run a shell in the container:

docker container exec -it $id sh

- Make a curl request towards the api endpoint

curl http://localhost/v1/data

curl -H "If-Modified-Since: Mon Jan 2 15:04:05 2006" https://localhost/v1/data

- Secure the services

Enforce mTLS and add default destination rule for mTLS

kubectl apply -f mutual-tls-istio-auth.yml

kubectl get meshpolicy default -o yaml

###

Connect the proxy:

docker container ls --filter name=istio-proxy_simple-go-service

docker container exec -it ****** sh

Access the API:

curl http://localhost/v1/data

Check the certs generated by Istio:

ls /etc/certs

curl -k https://localhost/v1/data --key /etc/certs/key.pem --cert /etc/certs/cert-chain.pem --cacert /etc/certs/root-cert.pem

cat /etc/certs/cert-chain.pem | openssl x509 -text -noout  | grep Validity -A 2

